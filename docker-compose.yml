version: '3.2'
services:
  metastore:
    build:
      context: ./metastore
    ports:
      - "1527:1527"
    volumes:
      - "./data/_metastore:/mnt/database"
    environment:
      DB_DIR: "/mnt/database"

  polynote:
    build:
      context: ./polynote
    depends_on:
      - metastore
    command: ["--config", "/opt/polynote/config.yml"]
    ports:
      - "8080:8192"
      - "4040-4050:4040-4050"
    volumes:
      - "./polynote/config.yml:/opt/polynote/config.yml"
      - "./polynote/notebooks:/mnt/notebooks"
      - "./data/spark-warehouse:/opt/polynote/spark-warehouse" # managed tables storage
      - "${PRJ_PATH}/data/input:/mnt/data_input" # input data provided by project (outside lake)
      - "./data:/mnt/data"  # lake storage
      - "${PRJ_PATH}/src/main/resources:/mnt/config" # SDL config to use DataObjects in notebooks

networks:
  default:
    name: spark
